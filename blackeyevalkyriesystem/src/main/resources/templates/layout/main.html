<!DOCTYPE html>
<html lang="en" xmlns:th="http://www.thymeleaf.org" 
      xmlns:layout="http://www.ultraq.net.nz/thymeleaf/layout"
      xmlns:sec="http://www.thymeleaf.org/extras/spring-security">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>BlackEyeValkyrieSystem - <th:block th:include=":: title">Title</th:block></title>
    
    <!-- Google Fonts -->
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@300;400;500;600;700&display=swap" rel="stylesheet">
    
    <!-- Custom CSS -->
    <link rel="stylesheet" th:href="@{/css/main.css}">
    
    <!-- Page specific CSS -->
    <th:block layout:fragment="head"></th:block>
</head>
<body>
    <div class="app-container">
        <!-- Sidebar -->
        <aside class="sidebar">
            <!-- Logo -->
            <a href="/" class="logo">
                <svg width="24" height="24" viewBox="0 0 24 24" fill="none" xmlns="http://www.w3.org/2000/svg">
                    <circle cx="12" cy="12" r="10" fill="#8A2BE2"/>
                    <path d="M12 7V17M7 12H17" stroke="white" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"/>
                </svg>
                BlackEyeValkyrieSystem
            </a>
            
            <!-- Search -->
            <div class="search-bar">
                <svg width="16" height="16" viewBox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg">
                    <path d="M7.33333 12.6667C10.2789 12.6667 12.6667 10.2789 12.6667 7.33333C12.6667 4.38781 10.2789 2 7.33333 2C4.38781 2 2 4.38781 2 7.33333C2 10.2789 4.38781 12.6667 7.33333 12.6667Z" stroke="white" stroke-width="1.33333" stroke-linecap="round" stroke-linejoin="round"/>
                    <path d="M14 14.0001L11.1 11.1001" stroke="white" stroke-width="1.33333" stroke-linecap="round" stroke-linejoin="round"/>
                </svg>
                <input type="text" placeholder="Search for...">
            </div>
            
            <!-- Navigation -->
            <nav>
                <a href="/" class="nav-item" th:classappend="${request != null && request.requestURI == '/' ? 'active' : ''}">
                    <svg width="16" height="16" viewBox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg">
                        <path d="M2 8.66667L8 2.66667L14 8.66667V13.3333C14 13.687 13.8595 14.0261 13.6095 14.2761C13.3594 14.5262 13.0203 14.6667 12.6667 14.6667H3.33333C2.97971 14.6667 2.64057 14.5262 2.39052 14.2761C2.14048 14.0261 2 13.687 2 13.3333V8.66667Z" stroke="white" stroke-width="1.33333" stroke-linecap="round" stroke-linejoin="round"/>
                        <path d="M6 14.6667V8.66667H10V14.6667" stroke="white" stroke-width="1.33333" stroke-linecap="round" stroke-linejoin="round"/>
                    </svg>
                    Main Page
                </a>
                
                <a href="#" class="nav-item dropdown-toggle" th:classappend="${request != null && request.requestURI.startsWith('/patient') ? 'expanded' : ''}">
                    <div class="nav-item-content">
                        <svg width="16" height="16" viewBox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg">
                            <path d="M10.6667 14V12.6667C10.6667 11.9594 10.3857 11.2811 9.88562 10.781C9.38552 10.281 8.70724 10 8 10H3.33333C2.62609 10 1.9478 10.281 1.44771 10.781C0.947617 11.2811 0.666666 11.9594 0.666666 12.6667V14" stroke="white" stroke-width="1.33333" stroke-linecap="round" stroke-linejoin="round"/>
                            <path d="M5.66667 7.33333C7.13943 7.33333 8.33333 6.13943 8.33333 4.66667C8.33333 3.19391 7.13943 2 5.66667 2C4.19391 2 3 3.19391 3 4.66667C3 6.13943 4.19391 7.33333 5.66667 7.33333Z" stroke="white" stroke-width="1.33333" stroke-linecap="round" stroke-linejoin="round"/>
                            <path d="M15.3333 14V12.6667C15.3328 12.0758 15.1362 11.5019 14.7742 11.0349C14.4122 10.5679 13.9053 10.2344 13.3333 10.0867" stroke="white" stroke-width="1.33333" stroke-linecap="round" stroke-linejoin="round"/>
                            <path d="M10.6667 2.08667C11.2406 2.2335 11.7492 2.56712 12.1118 3.03488C12.4744 3.50264 12.6709 4.07769 12.6709 4.67C12.6709 5.26232 12.4744 5.83737 12.1118 6.30513C11.7492 6.77289 11.2406 7.1065 10.6667 7.25334" stroke="white" stroke-width="1.33333" stroke-linecap="round" stroke-linejoin="round"/>
                        </svg>
                        Patient Profile
                    </div>
                    <svg class="dropdown-arrow" width="16" height="16" viewBox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg">
                        <path d="M4 6L8 10L12 6" stroke="white" stroke-width="1.33333" stroke-linecap="round" stroke-linejoin="round"/>
                    </svg>
                </a>
                
                <div class="dropdown-menu" th:classappend="${request != null && request.requestURI.startsWith('/patient') ? 'active' : ''}">
                    <a href="/patient/list" class="nav-item nav-subitem" th:classappend="${request != null && request.requestURI == '/patient/list' ? 'active' : ''}">
                        Patient List
                    </a>
                    
                    <a href="/patient/create" class="nav-item nav-subitem" th:classappend="${request != null && request.requestURI == '/patient/create' ? 'active' : ''}">
                        Create Patient Profile
                    </a>
                </div>
                
                <a href="/appointments" class="nav-item" th:classappend="${request != null && request.requestURI == '/appointments' ? 'active' : ''}">
                    <svg width="16" height="16" viewBox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg">
                        <path d="M12.6667 2.66667H3.33333C2.59695 2.66667 2 3.26362 2 4.00001V13.3333C2 14.0697 2.59695 14.6667 3.33333 14.6667H12.6667C13.403 14.6667 14 14.0697 14 13.3333V4.00001C14 3.26362 13.403 2.66667 12.6667 2.66667Z" stroke="white" stroke-width="1.33333" stroke-linecap="round" stroke-linejoin="round"/>
                        <path d="M10.6667 1.33333V4" stroke="white" stroke-width="1.33333" stroke-linecap="round" stroke-linejoin="round"/>
                        <path d="M5.33334 1.33333V4" stroke="white" stroke-width="1.33333" stroke-linecap="round" stroke-linejoin="round"/>
                        <path d="M2 6.66667H14" stroke="white" stroke-width="1.33333" stroke-linecap="round" stroke-linejoin="round"/>
                    </svg>
                    Appointment Scheduling
                </a>
                
                <a href="/settings" class="nav-item" th:classappend="${request != null && request.requestURI == '/settings' ? 'active' : ''}">
                    <svg width="16" height="16" viewBox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg">
                        <path d="M8 10C9.10457 10 10 9.10457 10 8C10 6.89543 9.10457 6 8 6C6.89543 6 6 6.89543 6 8C6 9.10457 6.89543 10 8 10Z" stroke="white" stroke-width="1.33333" stroke-linecap="round" stroke-linejoin="round"/>
                        <path d="M12.9333 8C12.9333 8 12.7333 8.73333 12.4 9.06667C12.0667 9.4 11.3333 9.6 11.3333 9.6L10.4 11.2L10.5333 12.3333L8 14L5.46667 12.3333L5.6 11.2L4.66667 9.6C4.66667 9.6 3.93333 9.4 3.6 9.06667C3.26667 8.73333 3.06667 8 3.06667 8C3.06667 8 3.26667 7.26667 3.6 6.93333C3.93333 6.6 4.66667 6.4 4.66667 6.4L5.6 4.8L5.46667 3.66667L8 2L10.5333 3.66667L10.4 4.8L11.3333 6.4C11.3333 6.4 12.0667 6.6 12.4 6.93333C12.7333 7.26667 12.9333 8 12.9333 8Z" stroke="white" stroke-width="1.33333" stroke-linecap="round" stroke-linejoin="round"/>
                    </svg>
                    Settings
                </a>
            </nav>
            
            <!-- User Profile -->
            <div class="user-profile">
                <div class="avatar">
                    <span>JC</span>
                </div>
                <div class="user-info">
                    <div class="user-name">John Carter</div>
                    <div class="user-role">Account settings</div>
                </div>
                <svg width="16" height="16" viewBox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg">
                    <path d="M4 6L8 10L12 6" stroke="white" stroke-width="1.33333" stroke-linecap="round" stroke-linejoin="round"/>
                </svg>
            </div>
            
            <!-- Theme Toggle will be added by JavaScript -->
        </aside>
        
        <!-- Main Content -->
        <main class="main-content">
            <!-- Header -->
            <div th:remove="tag" layout:fragment="custom-header">
                <header class="header">
                    <h1 layout:fragment="header-title">Page Title</h1>
                </header>
            </div>
            
            <!-- Content -->
            <div layout:fragment="content">
                Page content goes here
            </div>
        </main>
    </div>
    
    <!-- Scripts -->
    <script>
        // Global error handler to prevent uncaught exceptions from causing page crashes
        window.addEventListener('error', function(event) {
            console.error('JavaScript Error:', event.error);
            event.preventDefault();
            return true;
        });
        
        // Theme toggling functionality
        document.addEventListener('DOMContentLoaded', function() {
            const themeToggleBtn = document.getElementById('theme-toggle-btn');
            const moonIcon = document.getElementById('moon-icon');
            const sunIcon = document.getElementById('sun-icon');
            const themeLabel = themeToggleBtn.querySelector('.theme-label');
            
            // Check if user has a saved preference
            const savedTheme = localStorage.getItem('theme');
            
            // Apply saved theme or default to dark mode
            if (savedTheme === 'light') {
                document.documentElement.classList.add('light-mode');
                moonIcon.style.display = 'none';
                sunIcon.style.display = 'block';
                themeLabel.textContent = 'Switch to Dark Mode';
            }
            
            // Theme toggle button click handler
            themeToggleBtn.addEventListener('click', function() {
                // Toggle light mode class on root element
                document.documentElement.classList.toggle('light-mode');
                
                // Check if light mode is now active
                const isLightMode = document.documentElement.classList.contains('light-mode');
                
                // Update icons and label
                if (isLightMode) {
                    moonIcon.style.display = 'none';
                    sunIcon.style.display = 'block';
                    themeLabel.textContent = 'Switch to Dark Mode';
                    localStorage.setItem('theme', 'light');
                } else {
                    moonIcon.style.display = 'block';
                    sunIcon.style.display = 'none';
                    themeLabel.textContent = 'Switch to Light Mode';
                    localStorage.setItem('theme', 'dark');
                }
            });
            
            // Dropdown navigation handling (existing functionality)
            const dropdownToggles = document.querySelectorAll('.dropdown-toggle');
            
            dropdownToggles.forEach(function(toggle) {
                toggle.addEventListener('click', function() {
                    this.classList.toggle('expanded');
                    const dropdown = this.nextElementSibling;
                    if (dropdown.classList.contains('dropdown-menu')) {
                        if (dropdown.classList.contains('active')) {
                            dropdown.classList.remove('active');
                        } else {
                            dropdown.classList.add('active');
                        }
                    }
                });
            });
        });
    </script>
    <script th:src="@{/js/main.js}"></script>
    <script th:src="@{/js/theme-toggle.js}"></script>
    
    <!-- Page specific scripts -->
    <th:block layout:fragment="scripts"></th:block>
    
    <!-- Bootstrap JS from WebJars if needed -->
    <script th:src="@{/webjars/bootstrap/5.3.2/js/bootstrap.bundle.min.js}"></script>
</body>
</html> 