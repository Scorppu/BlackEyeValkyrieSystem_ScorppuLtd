<!DOCTYPE html>
<html xmlns:th="http://www.thymeleaf.org" xmlns:layout="http://www.ultraq.net.nz/thymeleaf/layout" layout:decorate="~{layout/main}">
<head>
    <title>Add Drug Interaction</title>
    <link rel="stylesheet" th:href="@{/css/drug-interaction-new.css}">
</head>
<body>
    <div layout:fragment="content">
        <div class="content-wrapper">
            <div class="content-header">
                <h1>Add Drug Interaction</h1>
                <a th:href="@{/drugs/interactions/import}" class="import-btn">
                    <svg width="16" height="16" viewBox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg">
                        <path d="M2 11L2 12C2 13.1046 2.89543 14 4 14L12 14C13.1046 14 14 13.1046 14 12L14 11" stroke="currentColor" stroke-width="1.5" stroke-linecap="round" stroke-linejoin="round"/>
                        <path d="M8 2L8 10" stroke="currentColor" stroke-width="1.5" stroke-linecap="round" stroke-linejoin="round"/>
                        <path d="M5 5L8 2L11 5" stroke="currentColor" stroke-width="1.5" stroke-linecap="round" stroke-linejoin="round"/>
                    </svg>
                    Import from CSV
                </a>
            </div>
            
            <!-- Error message -->
            <div th:if="${error}" class="alert alert-danger" style="margin-bottom: 20px;" th:text="${error}"></div>
            
            <div class="content-body">
                <!-- Main Drug Selection -->
                <div class="form-container">
                    <form id="interactionForm" th:action="@{/drugs/interactions/batch-add}" method="post">
                        <div class="form-group">
                            <label for="mainDrug" class="form-label">Main Drug</label>
                            <select id="mainDrug" name="mainDrug" class="form-select" required onchange="updateDrugsList()">
                                <option value="">-- Select Main Drug --</option>
                                <option th:each="drug : ${drugs}" 
                                        th:value="${drug.id}" 
                                        th:text="${drug.name}">Drug name</option>
                            </select>
                        </div>
                        <!-- Hidden container for form inputs -->
                        <div id="formInputsContainer"></div>
                    </form>
                </div>

                <!-- Interacting Drugs Selection -->
                <div class="row">
                    <div class="col-md-6">
                        <div class="form-container">
                            <h2>Available Drugs</h2>
                            <div style="margin-bottom: 15px;">
                                <input type="text" id="drugSearchInput" class="form-control" placeholder="Search drugs..." style="width: 100%; padding: 8px; border: 1px solid var(--border-color); border-radius: 4px;" oninput="filterDrugsList()">
                            </div>
                            <div class="drugs-list" id="drugsList">
                                <!-- Drug items will be populated dynamically -->
                                <div class="drug-item" style="font-style: italic; color: var(--secondary-text);">
                                    Please select a main drug first
                                </div>
                            </div>
                            <button type="button" id="addSelectedBtn" class="add-selected-btn" onclick="addSelectedDrugsToCart()" disabled>
                                Add Selected
                            </button>
                            <div style="clear: both;"></div>
                        </div>
                    </div>
                    <div class="col-md-6">
                        <div class="form-container">
                            <h2>Drug Interactions</h2>
                            <div id="drugCart" class="drug-cart">
                                <!-- Cart items will be added here dynamically -->
                                <div style="font-style: italic; color: var(--secondary-text); text-align: center; padding: 20px;">
                                    No interactions added yet
                                </div>
                            </div>
                            <div style="display: flex; justify-content: flex-end; margin-top: 15px; gap: 10px;">
                                <button type="button" id="saveInteractionsBtn" class="save-btn" onclick="submitInteractions()" disabled>
                                    Save Interactions
                                </button>
                            </div>
                            <div style="clear: both;"></div>
                        </div>
                    </div>
                </div>
            </div>
        </div>

        <!-- Interaction Details Modal -->
        <div id="interactionDetailsModal" class="modal">
            <div class="modal-content">
                <div class="modal-header">
                    <h3>Add Drug Interaction</h3>
                    <span class="close">&times;</span>
                </div>
                <div class="modal-body">
                    <div id="modalDrugsList">
                        <!-- Selected drugs list will be shown here -->
                    </div>
                </div>
                <div class="modal-footer">
                    <button type="button" class="btn btn-secondary" onclick="closeModal()">Cancel</button>
                    <button type="button" class="btn btn-primary" onclick="confirmAddToCart()">Add Interaction</button>
                </div>
            </div>
        </div>
    </div>
    
    <script layout:fragment="scripts" th:src="@{/js/drug-interaction-new.js}"></script>
</body>
</html>