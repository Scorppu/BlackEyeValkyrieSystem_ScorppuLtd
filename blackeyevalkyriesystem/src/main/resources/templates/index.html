<!DOCTYPE html>
<html xmlns:th="http://www.thymeleaf.org" xmlns:layout="http://www.ultraq.net.nz/thymeleaf/layout" layout:decorate="~{layout/main}">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>BVS - Home</title>
    
    <!-- Google Fonts -->
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@300;400;500;600;700&display=swap" rel="stylesheet">
    
    <!-- Custom CSS -->
    <link rel="stylesheet" th:href="@{/css/main.css}">
    
    <th:block layout:fragment="head">
        <!-- Dashboard-specific CSS -->
        <link rel="stylesheet" th:href="@{/css/dashboard.css}">
    </th:block>
</head>
<body>
    <!-- Main content -->
    <div layout:fragment="content">
        <h1>Main Page</h1>
        
        <div class="content-grid">
            <!-- Patient Stats -->
            <div class="content-card">
                <h2>Total Patient</h2>
                
                <div class="chart-container">
                    <div class="donut-chart">
                        <svg width="100%" height="100%" viewBox="0 0 130 130">
                            <!-- Background circle -->
                            <circle cx="65" cy="65" r="55" fill="none" stroke="#111133" stroke-width="14" />
                            
                            <!-- Blue progress circle (Discharged) -->
                            <circle cx="65" cy="65" r="55" fill="none" stroke="#30A9DE" stroke-width="14"
                                    stroke-dasharray="345" th:attr="stroke-dashoffset=${345 - (345 * (dischargedPercentage + admittedPercentage + activePercentage) / 100)}"
                                    stroke-dashoffset="276"
                                    transform="rotate(-90 65 65)" />

                            <!-- Green progress circle (Admitted) -->
                            <circle cx="65" cy="65" r="55" fill="none" stroke="#2be256" stroke-width="14"
                                    stroke-dasharray="345" th:attr="stroke-dashoffset=${345 - (345 * (admittedPercentage + activePercentage) / 100)}"
                                    stroke-dashoffset="173"
                                    transform="rotate(-90 65 65)" />

                            <!-- Purple progress circle (Active) -->
                            <circle cx="65" cy="65" r="55" fill="none" stroke="#8A2BE2" stroke-width="14"
                                    stroke-dasharray="345" th:attr="stroke-dashoffset=${345 - (345 * activePercentage / 100)}"
                                    stroke-dashoffset="173"
                                    transform="rotate(-90 65 65)" />
                        </svg>
                        <div class="chart-center">
                            <div class="chart-value" th:text="${totalPatients}">0</div>
                        </div>
                    </div>
                </div>
                
                <div class="chart-caption">
                    <div class="chart-legend">
                        <div class="legend-color" style="background-color: #8A2BE2;"></div>
                        Active
                        <div class="legend-value" th:text="${activePercentage + '%'}">50%</div>
                    </div>
                    <div class="chart-legend">
                        <div class="legend-color" style="background-color: #2be256;"></div>
                        Admitted
                        <div class="legend-value" th:text="${admittedPercentage + '%'}">30%</div>
                    </div>
                    <div class="chart-legend">
                        <div class="legend-color" style="background-color: #30A9DE;"></div>
                        Discharged
                        <div class="legend-value" th:text="${dischargedPercentage + '%'}">20%</div>
                    </div>
                </div>
            </div>
            
            <!-- Calendar -->
            <div class="content-card">
                <div class="calendar-controls">
                    <div class="calendar-month">December 2, 2021</div>
                    <div class="calendar-nav">
                        <button aria-label="Previous Month">
                            <svg width="16" height="16" viewBox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg">
                                <path d="M10 12L6 8L10 4" stroke="currentColor" stroke-width="1.5" stroke-linecap="round" stroke-linejoin="round"/>
                            </svg>
                        </button>
                        <button aria-label="Next Month">
                            <svg width="16" height="16" viewBox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg">
                                <path d="M6 4L10 8L6 12" stroke="currentColor" stroke-width="1.5" stroke-linecap="round" stroke-linejoin="round"/>
                            </svg>
                        </button>
                    </div>
                </div>
                
                <div class="calendar-header">
                    <div class="calendar-day">S</div>
                    <div class="calendar-day">M</div>
                    <div class="calendar-day">T</div>
                    <div class="calendar-day">W</div>
                    <div class="calendar-day">T</div>
                    <div class="calendar-day">F</div>
                    <div class="calendar-day">S</div>
                </div>
                
                <div class="calendar-grid">
                    <!-- Calendar dates will be generated by JavaScript -->
                </div>
            </div>
            
            <!-- Drug List -->
            <div class="content-card">
                <h2>Drug</h2>
                
                <table class="drug-list">
                    <thead>
                        <tr>
                            <th style="width: 70%;">Products</th>
                            <th style="width: 30%;">Route of Administration</th>
                        </tr>
                    </thead>
                    <tbody>
                        <tr th:each="drug, iterStat : ${drugs}" th:if="${iterStat.index < 5}">
                            <td>
                                <div class="drug-name">
                                    <div class="drug-icon">
                                        <svg width="16" height="16" viewBox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg">
                                            <path d="M12.6667 5.33333L10.6667 3.33333M6 12L3.33334 9.33333C2.89131 8.8913 2.89131 8.1087 3.33334 7.66667L8.66668 2.33333C9.1087 1.89131 9.8913 1.89131 10.3333 2.33333L13.6667 5.66667C14.1087 6.1087 14.1087 6.8913 13.6667 7.33333L8.33334 12.6667C7.8913 13.1087 7.1087 13.1087 6.66668 12.6667L6 12ZM3.33334 12.6667L6.00001 9.99999L2.00001 6.00001L5.33334 2.66667L9.33334 6.66667L6.00001 9.99999L3.33334 12.6667Z" stroke="white" stroke-width="1.5" stroke-linecap="round" stroke-linejoin="round"/>
                                        </svg>
                                    </div>
                                    <span th:text="${drug.name}">Medication Name</span>
                                </div>
                            </td>
                            <td th:text="${drug.routeOfAdministration}">Oral</td>
                        </tr>
                        <tr th:if="${#lists.isEmpty(drugs)}">
                            <td colspan="2" style="text-align: center; padding: 1rem;">
                                No drugs available
                            </td>
                        </tr>
                    </tbody>
                </table>
                
                <div style="text-align: center; margin-top: 1rem;">
                    <a href="/drugs" class="btn btn-outline" sec:authorize="hasRole('ROLE_ADMIN')">more...</a>
                </div>
            </div>
            
            <!-- Duty Status Section -->
            <div class="content-card">
                <h2>Duty Status</h2>
                <div style="height: min(22vh, 150px); display: flex; justify-content: center; align-items: center;">
                    <div class="duty-status-container">
                        <div class="chart-container">
                            <h3>Doctors</h3>
                            <div class="box-plot">
                                <div class="box-container">
                                    <div class="box-section on-duty" id="doctors-on-duty-box">
                                        <span class="box-value" id="doctors-on-duty-value" th:text="${doctorsOnDuty != null ? doctorsOnDuty : 0}"></span>
                                    </div>
                                    <div class="box-section off-duty" id="doctors-off-duty-box">
                                        <span class="box-value" id="doctors-off-duty-value" th:text="${doctorsOffDuty != null ? doctorsOffDuty : 0}"></span>
                                    </div>
                                </div>
                            </div>
                        </div>
                        
                        <div class="chart-container">
                            <h3>Nurses</h3>
                            <div class="box-plot">
                                <div class="box-container">
                                    <div class="box-section on-duty" id="nurses-on-duty-box">
                                        <span class="box-value" id="nurses-on-duty-value" th:text="${nursesOnDuty != null ? nursesOnDuty : 0}"></span>
                                    </div>
                                    <div class="box-section off-duty" id="nurses-off-duty-box">
                                        <span class="box-value" id="nurses-off-duty-value" th:text="${nursesOffDuty != null ? nursesOffDuty : 0}"></span>
                                    </div>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>
                <div>
                    <div class="chart-caption">
                        <div class="chart-legend">
                            <div class="legend-color" style="background-color: var(--accent-color);"></div>
                            On Duty
                        </div>
                        <div class="chart-legend">
                            <div class="legend-color" style="background-color: #2e3243;"></div>
                            Off Duty
                        </div>
                    </div>
                </div>
                <div style="text-align: center;">
                    <a href="/duty-status" class="btn btn-outline" sec:authorize="hasRole('ROLE_ADMIN')">more...</a>
                </div>
            </div>
        </div>
    </div>
    
    <!-- Include scripts at the bottom using the layout:fragment attribute -->
    <th:block layout:fragment="scripts">
        <script th:src="@{/js/dashboard.js}"></script>
    </th:block>
</body>
</html> 